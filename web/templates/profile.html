{% extends "base.html" %}
{% load static %}

{% block content %}
<h1>Perfil de {{ user.name}}</h1>

<!-- Info básica -->

<div class="profile-content">
  <!-- Sección izquierda -->
  <div class="profile-left-section">
    <div class="profile-image-container">
      <form method="post" enctype="multipart/form-data" id="profile-picture-form">
        {% csrf_token %}
        <div class="profile-picture-wrapper" title="Haz clic para cambiar la foto">
          {% if user.profile_picture %}
            <img src="{{ user.profile_picture.url }}" alt="Foto de perfil" class="profile-picture">
          {% else %}
            <div class="profile-picture-placeholder">
              <span>{{ user.name|first }}</span>
            </div>
          {% endif %}
          <div class="edit-icon">
            <i class="fas fa-pencil-alt"></i>
          </div>
        </div>
        <input type="file" name="profile_picture" id="id_profile_picture" accept="image/*" style="display: none;">
      </form>
    </div>

    <h2 class="profile-name">{{ user.name }}</h2>

    <div class="profile-info">
      <p><strong>Nombre de usuario:</strong> {{ user.username }}</p>
      <p><strong>Correo:</strong> {{ user.email }}</p>
      <a href="{% url 'edit_profile' %}">Editar perfil</a>
    </div>
  </div>

    <hr>
 <!-- Sección derecha -->
  <div class="profile-right-section">
    <section>
      <h2>Libros que tienes</h2>
      <ul>
        {% for item in have_list %}
          <li>{{ item.book.title }} por {{ item.book.author }}</li>
        {% empty %}
          <li>No has añadido libros que tienes.</li>
        {% endfor %}
      </ul>
    </section>

    <section>
      <h2>Libros que deseas</h2>
      <ul>
        {% for item in want_list %}
          <li>{{ item.book.title }} por {{ item.book.author }}</li>
        {% empty %}
          <li>No has añadido libros que deseas.</li>
        {% endfor %}
      </ul>
    </section>

    <section>
      <h2>Intercambios</h2>
      <ul>
        {% for exchange in exchanges_list %}
          <li>Intercambio con {{ exchange.user2.get_full_name|default:exchange.user2.username }} – Libro ofrecido: {{ exchange.book.title }}</li>
        {% empty %}
          <li>No has realizado intercambios.</li>
        {% endfor %}
      </ul>
    </section>

    <section>
      <h2>Ventas y donaciones</h2>
      <ul>
        {% for sale in sales_list %}
          <li>{{ sale.book.title }} – {{ sale.get_type_display }} – {{ sale.price }} €</li>
        {% empty %}
          <li>No has vendido ni donado libros.</li>
        {% endfor %}
      </ul>
    </section>

    <section>
      <h2>Reseñas recibidas</h2>
      <ul>
        {% for review in reviews_list %}
          <li>
            <strong>{{ review.reviewer.get_full_name|default:review.reviewer.username }}</strong>: "{{ review.comment }}"<br>
            Calificación: {{ review.rating }}/5
          </li>
        {% empty %}
          <li>No has recibido reseñas aún.</li>
        {% endfor %}
      </ul>
    </section>
  </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const wrapper = document.querySelector('.profile-picture-wrapper');
        const fileInput = document.getElementById('id_profile_picture');
        const form = document.getElementById('profile-picture-form');

        wrapper.addEventListener('click', function() {
            fileInput.click();
        });

        fileInput.addEventListener('change', function() {
            if (fileInput.files.length > 0) {
                form.submit();
            }
        });
    });
</script>
{% endblock %}
